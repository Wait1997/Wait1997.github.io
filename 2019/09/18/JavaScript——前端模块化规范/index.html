<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>JavaScript——前端模块化规范</title><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1"><meta name="description"><meta name="keywords"><meta name="author" content="xiaoxiong"><link rel="short icon" href="/images/favicon.png"><link rel="icon" href="/images/favicon.png"><!--[if lt IE 9]>
<script src="/js/modernizr.js"></script>
<![endif]-->
<link rel="stylesheet" href="/css/iconfont.css">

<link rel="stylesheet" href="/css/index.css?v=202002200025.css">
<link rel="stylesheet" href="/css/info.css?v=202002200025.css">
<link href="https://cdn.bootcss.com/highlight.js/9.15.9/styles/github.min.css" rel="stylesheet"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Wait1997" type="application/atom+xml">
</head><body><header id="header" class="header-navigation"><nav><div class="logo"><a href="http://yoursite.com">Wait1997</a></div><h2 id="mnavh"><span class="navicon"></span></h2><ul id="starlist"><li><a href="/">首页</a></li><li><a href="/time.html">时间轴</a></li></ul><div class="searchbox"><div id="search_bar" class="search_bar"><input id="keyboard" placeholder="想搜点什么呢.." type="text" name="keyboard" autocomplete="off" class="input"><p class="search_ico"><span></span></p></div></div></nav></header><article><main><div class="con_warp"><div class="infosbox"><div class="newsview"><h3 class="news_title">JavaScript——前端模块化规范</h3><div class="bloginfo"><ul><li class="author">作者：<a href="/">xiaoxiong</a></li><li class="lmname"><a href="/"></a></li><li class="timer">时间：2019-09-18 22:40:18</li><li class="view"><span id="busuanzi_value_page_pv">99</span><span>次访问</span></li></ul></div><div class="tags"><a href="/tags/JavaScript/" target="_blank">JavaScript</a></div><div class="news_con"><h4 id="前端模块化（CommonJs-ES6-Module-AMD和CMD）"><a href="#前端模块化（CommonJs-ES6-Module-AMD和CMD）" class="headerlink" title="前端模块化（CommonJs,ES6 Module, AMD和CMD）"></a>前端模块化<code>（CommonJs,ES6 Module, AMD和CMD）</code></h4><blockquote>
<p>传统非模块化开发有如下缺点：命名冲突    文件依赖</p>
</blockquote>
<h5 id="为什么要使用模块化"><a href="#为什么要使用模块化" class="headerlink" title="为什么要使用模块化"></a>为什么要使用模块化</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#1. test.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">    &lt;script src=<span class="string">"js/module1.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    &lt;script src=<span class="string">"js/module2.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var module=function()&#123;</span></span><br><span class="line"><span class="regexp">        console.log('I am module3');</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">    module();</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line">#2.module1.js</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">module</span>=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    cosonle.log(<span class="string">'I am module1.js'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">#3.module2.js</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">module</span>=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"I am module2.js"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#4. 上面代码的问题</span><br><span class="line">#4.1 加载js的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长(JS会堵塞DOM解析)</span><br><span class="line">#4.2 js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。</span><br><span class="line">#4.3 多个js文件中声明了同名的变量的时候，会出现命名污染的问题</span><br></pre></td></tr></table></figure>



<h4 id="1-AMD-require-js"><a href="#1-AMD-require-js" class="headerlink" title="1. AMD(require.js)"></a>1. <code>AMD(require.js)</code></h4><blockquote>
<p>为什么会出现<code>AMD</code>规范呢？为什么会出现<code>require.js</code>呢？解决了什么问题？</p>
</blockquote>
<p>在没有<code>AMD</code>规范之前，我们是采用<code>Commonjs</code>规范，但是<code>Commonjs</code>规范是同步加载模块，它是<code>node</code>普通采用的一种模块机制，对于<code>node</code>而言，常见的加载本地文件或者其他各种I/O操作，速度是很快的，我们采用<strong>同步机制</strong>去加载模块文件是没有问题的，<strong>但是对于浏览器端而言，请求网络资源的速度是很慢的，如果依然采用同步方式去请求资源，浏览器端很可能造成阻塞问题</strong></p>
<p>所以，解决方法是什么呢？<code>AMD(Asynchronous Module Definition)</code>异步模块定义 而<code>require.js</code>是<code>AMD</code>规范的具体实现</p>
<p>例如：</p>
<p>我们希望在<code>index.html</code>，引入<code>main.js, a.js, b.js, c.js</code>四个<code>js</code>文件</p>
<blockquote>
<p>最原始的方法</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=<span class="string">"./lib/a.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script src=<span class="string">"./lib/b.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script src=<span class="string">"./lib/c.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script src=<span class="string">"./lib/main.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br><span class="line"></span><br><span class="line"># 问题：这样只能从上到下，同步加载js文件，可能由于前面的js文件过大，造成阻塞问题</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用<code>require.js</code> 来异步加载<code>js</code>文件</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">AMD ： Asynchronous Module Definition。AMD 是 RequireJS 在推广过程中对模块定义的规范化的产出</span><br><span class="line">#1.定义</span><br><span class="line">define(id?,dependencies?,factory);</span><br><span class="line">    - id: 定义中模块的名字;可选；如果没有提供该参数,模块的名字应该默认为模块加载器请求的指定脚本的名字.</span><br><span class="line">    - 依赖dependencies：是一个当前模块依赖的,已被模块定义的模块标识的数组字面量</span><br><span class="line">    - 工厂方法factory,模块初始化要执行的函数或对象.如果为函数,它应该只被执行一次.如果是对象,此对象应该为模块的输出值.</span><br><span class="line">    - 默认情况下文件名即为模块名</span><br><span class="line"></span><br><span class="line">#2.导入</span><br><span class="line"><span class="built_in">require</span>([dependencies],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line">    - 第一个参数是一个数组,表示所依赖的模块</span><br><span class="line">    - 第二个参数是一个回调函数,当前面指定的模块都加载成功后,它将被调用.加载的模块会以参数形式传入该函数,从而在回调函数内部就可以使用这些模块</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- 引入require.js --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="js/</span><span class="built_in">require</span>.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">     //main.js</span></span><br><span class="line"><span class="string">     //写法1：直接引入js文件</span></span><br><span class="line"><span class="string">     require(['./a', './b', './c'], function () &#123;</span></span><br><span class="line"><span class="string">       console.log('文件全部加载成功');</span></span><br><span class="line"><span class="string">     &#125;);</span></span><br><span class="line"><span class="string">     //写法2：设置js文件别名</span></span><br><span class="line"><span class="string">     require.config(&#123;</span></span><br><span class="line"><span class="string">       paths: &#123;</span></span><br><span class="line"><span class="string">         aaa: './lib/a',</span></span><br><span class="line"><span class="string">         bbb: './lib/b',</span></span><br><span class="line"><span class="string">         ccc: './lib/c'</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">     &#125;);</span></span><br><span class="line"><span class="string">  #或者</span></span><br><span class="line"><span class="string">  require.config(&#123;</span></span><br><span class="line"><span class="string">    baseUrl: './lib',</span></span><br><span class="line"><span class="string">    paths: &#123;</span></span><br><span class="line"><span class="string">      aaa: 'a',</span></span><br><span class="line"><span class="string">      bbb: 'b',</span></span><br><span class="line"><span class="string">      ccc: 'c'</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  require(['aaa', 'bbb', 'ccc'], function () &#123;</span></span><br><span class="line"><span class="string">    console.log('文件全部加载成功');</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="AMD与require-js的关系"><a href="#AMD与require-js的关系" class="headerlink" title="AMD与require.js的关系"></a><code>AMD</code>与<code>require.js</code>的关系</h5><blockquote>
<p><code>AMD</code>是一种规范，而<code>require.js</code>是真正的实现，主要解决了两个问题：</p>
<p>1：实现<code>js</code>文件的异步加载，避免同步加载导致的网页阻塞</p>
<p>2: 定义模块之间如何相互依赖，可以更好的管理模块</p>
</blockquote>
<h5 id="AMD规范代码实例"><a href="#AMD规范代码实例" class="headerlink" title="AMD规范代码实例"></a><code>AMD</code>规范代码实例</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;!-- 引入require.js --&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="js/</span><span class="built_in">require</span>.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;script&gt;</span></span><br><span class="line"><span class="string">    //模块的配置</span></span><br><span class="line"><span class="string">    require.config(&#123;</span></span><br><span class="line"><span class="string">      baseUrl: "</span>./js<span class="string">",</span></span><br><span class="line"><span class="string">      paths: &#123;</span></span><br><span class="line"><span class="string">        calculator: "</span>calculator<span class="string">"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //引入calculator模块,function中的calculator参数表示模块对象</span></span><br><span class="line"><span class="string">    require(['calculator'], function (calculator) &#123;</span></span><br><span class="line"><span class="string">      console.log(calculator.add("</span><span class="number">2</span><span class="string">", "</span><span class="number">3</span><span class="string">")); // 5</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#calculator</span></span><br><span class="line"><span class="string">// 引入</span></span><br><span class="line"><span class="string">require.config(&#123;</span></span><br><span class="line"><span class="string">  paths: &#123;</span></span><br><span class="line"><span class="string">    convertor: "</span>./convertor<span class="string">"</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//定义calculator模块，该模块依赖于convertor模块，function中的convertor表示convertor模块对象</span></span><br><span class="line"><span class="string">define("</span>calculator<span class="string">", ['convertor', 'exports', 'module'], function (convertor, exports, module) &#123;</span></span><br><span class="line"><span class="string">  var add = function (a, b) &#123;</span></span><br><span class="line"><span class="string">    return convertor.convertToNumber(a) + convertor.convertToNumber(b);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  //导出模块方式一：直接return</span></span><br><span class="line"><span class="string">  return &#123;</span></span><br><span class="line"><span class="string">    add: add</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  //导出模块方式二：使用 module.exports</span></span><br><span class="line"><span class="string">  // module.exports = &#123;</span></span><br><span class="line"><span class="string">  //   add : add</span></span><br><span class="line"><span class="string">  // &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  //导出模块方式三：使用 exports.xx       注意，不能直接给exports赋值，比如exports = &#123;&#125;</span></span><br><span class="line"><span class="string">  // exports.add = add;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#calculator</span></span><br><span class="line"><span class="string">//定义convertor模块</span></span><br><span class="line"><span class="string">define("</span>convertor<span class="string">", [], function () &#123;</span></span><br><span class="line"><span class="string">  var convertToNumber = function convertToNumber(input) &#123;</span></span><br><span class="line"><span class="string">    return parseFloat(input);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return &#123;</span></span><br><span class="line"><span class="string">    convertToNumber: convertToNumber</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="2-CMD-sea-js"><a href="#2-CMD-sea-js" class="headerlink" title="2. CMD(sea.js)"></a>2. <code>CMD(sea.js)</code></h4><blockquote>
<p><code>CMD</code> 即<code>Common Module Definition</code>通用模块定义，<code>CMD</code>规范是国内发展出来的，就像<code>AMD</code>有个<code>requireJS</code>，<code>CMD</code>有个浏览器的实现<code>SeaJS</code>，<code>SeaJS</code>要解决的问题和<code>requireJS</code>一样，只不过在模块定义方式和模块加载（可以说运行、解析）时机上有所不同</p>
</blockquote>
<h5 id="CMD模块化规范"><a href="#CMD模块化规范" class="headerlink" title="CMD模块化规范"></a><code>CMD模块化规范</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CMD 即Common Module Definition通用模块定义,CMD规范是国内发展出来的</span><br><span class="line"></span><br><span class="line">#1. 定义</span><br><span class="line">define(id?,d?,factory)</span><br><span class="line">- id : 因为CMD推崇一个文件一个模块,所以经常就用文件名作为模块id</span><br><span class="line">- d : CMD推崇依赖就近,所以一般不在define的参数中写依赖</span><br><span class="line">- factory :函数   <span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span></span><br><span class="line"><span class="function">        <span class="title">require</span> 是一个方法,用来获取其他模块提供的接口</span></span><br><span class="line"><span class="function">        <span class="title">exports</span> 是一个对象,用来向外提供模块接口</span></span><br><span class="line"><span class="function">        <span class="title">module</span> 是一个对象,上面存储了与当前模块相关联的一些属性和方法</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">#2. 使用</span></span><br><span class="line"><span class="function"><span class="title">seajs</span>.<span class="title">use</span>(<span class="params"><span class="string">'mymodel.js'</span>,function(mymodel</span>)</span>&#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>seajs/dist/sea.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;script&gt;</span></span><br><span class="line"><span class="string">    // 在seajs中模块的引入需要相对路径完整写法</span></span><br><span class="line"><span class="string">    seajs.use('./js/calculator.js', function (calculator) &#123;</span></span><br><span class="line"><span class="string">      //calculator其实就是calculator.js中的exports对象</span></span><br><span class="line"><span class="string">      var value = calculator.add("</span><span class="number">1</span><span class="string">", "</span><span class="number">11</span><span class="string">");</span></span><br><span class="line"><span class="string">      console.log(value);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#calculator.js</span></span><br><span class="line"><span class="string">// 定义一个模块，遵循Seajs的写法</span></span><br><span class="line"><span class="string">define(function (require, exports, module) &#123;</span></span><br><span class="line"><span class="string">  // 此处是模块的私有空间</span></span><br><span class="line"><span class="string">  // 载入convertor.js模块</span></span><br><span class="line"><span class="string">  var convertor = require('./convertor.js');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  console.log(convertor);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 定义模块的私有成员</span></span><br><span class="line"><span class="string">  function add(a, b) &#123;</span></span><br><span class="line"><span class="string">    return convertor.convertToNumber(a) + convertor.convertToNumber(b);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // 暴露模块的公共成员</span></span><br><span class="line"><span class="string">  // 方式1</span></span><br><span class="line"><span class="string">  // exports.add = add;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 方式2</span></span><br><span class="line"><span class="string">  // return &#123;</span></span><br><span class="line"><span class="string">  //   add: add</span></span><br><span class="line"><span class="string">  // &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  module.exports = &#123;</span></span><br><span class="line"><span class="string">    add: add</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  /*</span></span><br><span class="line"><span class="string">  导出模块仍然三种方式</span></span><br><span class="line"><span class="string">  module.exports</span></span><br><span class="line"><span class="string">  exports.xxx</span></span><br><span class="line"><span class="string">  return</span></span><br><span class="line"><span class="string">  */</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#convertor</span></span><br><span class="line"><span class="string">define(function (require, exports, module) &#123;</span></span><br><span class="line"><span class="string">  // 公开一些转换逻辑</span></span><br><span class="line"><span class="string">  exports.convertToNumber = function (input) &#123;</span></span><br><span class="line"><span class="string">    return parseFloat(input);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>

<h5 id="AMD与CMD的区别"><a href="#AMD与CMD的区别" class="headerlink" title="AMD与CMD的区别"></a><code>AMD</code>与<code>CMD</code>的区别</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>CMD 推崇依赖就近;AMD 推崇依赖前置</span><br><span class="line"><span class="number">2.</span>CMD 是延迟执行,懒加载;AMD 是提前执行</span><br><span class="line"><span class="number">3.</span>CMD性能好,因为只有用户需要的时候才执行;AMD用户体验好,因为没有延迟,依赖模块提前执行了</span><br><span class="line"></span><br><span class="line"># 总结：AMD和CMD最大的区别是对依赖模块的执行时机处理不同,注意不是加载的时机或者方式不同。两者都是异步加载模块。</span><br><span class="line"></span><br><span class="line"><span class="comment">//AMD</span></span><br><span class="line">define([<span class="string">'./a'</span>,<span class="string">'./b'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">      a.doSomething()</span><br><span class="line">      b.dosomething()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//CMD</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> a=<span class="built_in">require</span>(<span class="string">'./a'</span>)</span><br><span class="line">      a.doSomethimg()</span><br><span class="line">      <span class="keyword">var</span> b=<span class="built_in">require</span>(<span class="string">'./b'</span>)</span><br><span class="line">      b.doSomething()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-COMMON-JS-node-服务端"><a href="#3-COMMON-JS-node-服务端" class="headerlink" title="3.COMMON.JS(node)服务端"></a>3.<code>COMMON.JS(node)</code>服务端</h4><blockquote>
<p>Node 应用由模块组成，采用<code>CommonJS</code> 模块规范。每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。<strong>在服务器端，模块的加载是运行时同步加载的；在浏览器端，模块需要提前编译打包处理。</strong></p>
<p><code>CommonJS</code>规范加载模块是<strong>同步</strong>的，也就是说，只有加载完成，才能执行后面的操作。</p>
</blockquote>
<p>基本语法：</p>
<ul>
<li>暴露模块：<code>module.exports = value</code> 或 <code>exports.xxx = value</code></li>
<li>引入模块：<code>require(xxx)</code>,如果是第三方模块，<code>xxx</code>为模块名；如果是自定义模块，<code>xxx</code>为模块文件路径</li>
</ul>
<p>但是，<code>CommonJs</code>有一个重大的局限使得它<strong>不适用于浏览器环境</strong>，那就是<code>require</code>操作是同步的。这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。</p>
<p>因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.导出单个成员</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line">exports.foo = <span class="string">'hello'</span></span><br><span class="line">exports.add = add</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.导出多个成员</span></span><br><span class="line"><span class="comment">// 如果一个模块需要直接导出某个成员，而非挂载的方式</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  add: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">  &#125;,</span><br><span class="line">  str: <span class="string">'hello'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 导出单个成员和多个成员的原理：</span><br><span class="line">	为了方便，node为每个模块提供一个exports变量，其指向<span class="built_in">module</span>.exports，相当于在模块头部加了这句话：</span><br><span class="line">	<span class="keyword">var</span> exports = <span class="built_in">module</span>.exports，在对外输出时，可以给exports对象添加方法</span><br><span class="line">    PS：exports不能直接赋值（因为这样就切断了exports和<span class="built_in">module</span>.exports的联系）;</span><br></pre></td></tr></table></figure>

<h4 id="4-ES6模块化规范"><a href="#4-ES6模块化规范" class="headerlink" title="4. ES6模块化规范"></a>4. <code>ES6</code>模块化规范</h4><ul>
<li><code>ES6</code>在语言标准的层面上，实现了模块功能，而且实现得相当简单，完全可以取代 <code>CommonJS</code> 和 <code>AMD</code>规范，成为浏览器和服务器通用的模块解决方案。</li>
<li><code>ES6</code> 模块设计思想：尽量的静态化、使得编译时就能确定模块的依赖关系，以及输入和输出的变量（<code>CommonJS</code>和<code>AMD</code>模块，都只能在运行时确定这些东西）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 导入</span><br><span class="line">import &quot;&#x2F;app&quot;;</span><br><span class="line">import React from “react”;</span><br><span class="line">import &#123; Component &#125; from “react”;</span><br><span class="line">&#x2F;&#x2F; 导出</span><br><span class="line">export function multiply() &#123;...&#125;;</span><br><span class="line">export var year &#x3D; 2018;</span><br><span class="line">export default ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：</li>
</ul>
<ol>
<li>容易进行静态分析</li>
<li>面向未来的 <code>EcmaScript</code> 标准</li>
</ol>
<ul>
<li>缺点：</li>
</ul>
<ol>
<li>原生浏览器端还没有实现该标准</li>
<li>全新的命令字，新版的 <code>Node.js</code>才支持</li>
</ol>
<h5 id="require与import的区别"><a href="#require与import的区别" class="headerlink" title="require与import的区别"></a><code>require</code>与<code>import</code>的区别</h5><ul>
<li><code>require</code>使用与<code>CommonJs</code>规范，<code>import</code>使用于<code>Es6</code>模块规范；所以两者的区别实质是两种规范的区别；</li>
<li><strong><code>CommonJS</code>：</strong></li>
</ul>
<ol>
<li>对于基本数据类型，属于复制。即会被模块缓存；同时，在另一个模块可以对该模块输出的变量重新赋值。</li>
<li>对于复杂数据类型，属于浅拷贝。由于两个模块引用的对象指向同一个内存空间，因此对该模块的值做修改时会影响另一个模块。</li>
<li>当使用require命令加载某个模块时，就会运行整个模块的代码。</li>
<li>当使用require命令加载同一个模块时，不会再执行该模块，而是取到缓存之中的值。也就是说，<code>CommonJS</code>模块无论加载多少次，都只会在第一次加载时运行一次，以后再加载，就返回第一次运行的结果，除非手动清除系统缓存。</li>
<li>循环加载时，属于加载时执行。即脚本代码在require的时候，就会全部执行。一旦出现某个模块被”循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</li>
</ol>
<ul>
<li><strong><code>ES6模块</code></strong></li>
</ul>
<ol>
<li><code>ES6</code>模块中的值属于【动态只读引用】。</li>
<li>对于只读来说，即不允许修改引入变量的值，import的变量是只读的，不论是基本数据类型还是复杂数据类型。当模块遇到import命令时，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。</li>
<li>对于动态来说，原始值发生变化，import加载的值也会发生变化。不论是基本数据类型还是复杂数据类型。</li>
<li>循环加载时，<code>ES6</code>模块是动态引用。只要两个模块之间存在某个引用，代码就能够执行。</li>
</ol>
<ul>
<li>最后：<code>require/exports</code> 是必要通用且必须的；因为事实上，目前你编写的 <code>import/export</code>最终都是编译为 <code>require/exports</code>来执行的。</li>
</ul>
</div></div><div class="nextinfo"><p>上一篇：<a href="/2019/10/08/React%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94reactRouter4/">React学习——reactRouter4</a></p><p>下一篇：<a href="/2019/09/13/React%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94setState%E8%AF%A6%E8%A7%A3/">React学习——setState详解</a></p></div><div class="news_pl"><div id="comment_container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script src="/js/md5.min.js"></script>
<script>const gitalk = new Gitalk({
    clientID: 'you github Client ID',
    clientSecret: 'you github Client Secret',
    repo: 'https://github.com/Wait1997',
    owner: 'xiaoxiong',
    admin: ['xiaoxiong'],
    id: md5("2019/09/18/JavaScript——前端模块化规范/"),      // Ensure uniqueness and length less than 50
    distractionFreeMode: true  // Facebook-like distraction free mode
})
gitalk.render('comment_container')</script></div></div></div></main><aside class="r_box"><div class="card box"><h2>我的名片</h2><div class="box_con"><p>网名：Wait1997</p>
<p>职业：Web前端工程师</p>
<p>Email：pursue97@163.com</p>
</div></div><div class="category box"><h2>文章分类</h2><div class="box_con"></div></div><div class="wechat box"><h2>我的微信</h2><div class="box_con"><img src="/images/jj.jpg"></div></div></aside></article><footer><section class="footer_bottom"><div class="footer_container"><p class="copyright"></p><ul class="social_network"></ul></div></section></footer><div class="cd-top"><i class="iconfont icon-top"></i></div>
<script src="/js/jquery.min.js"></script>
<script src="/js/scrollreveal.js"></script>
<script src="/js/hc-sticky.js"></script>
<script src="/js/canvas-nest.js" type="text/javascript" color="47,135,193" opacity="0.7" zIndex="-2" count="199"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/highlight.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/languages/java.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/languages/javascript.min.js"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="/js/common.js?v=202002200025.js"></script>
<script src="/js/index.js?v=202002200025.js"></script>
</body></html>